import{b as U,c as w}from"./chunk-V44IV2P3.js";import"./chunk-NLMHZ7JJ.js";function L(e){return e.replace(/([^:]\/)\/+/g,"$1").replace(/^\/+/,"/")}var A=(e=>(e.EXPORT_MANIFEST="scene/export_manifest.json",e.CODE_PREFIX="scene/code",e.PROPERTIES="scene/code/properties.json",e.EDITOR="scene/editor.json",e.ASSETS="scene/assets.json",e.POLYGONJS="js/all.js",e.SCENE_DATA_LOADER="js/sceneDataLoader.js",e.POLY_CONFIG="js/polyConfig.js",e.JS_FILES="scene/js_files.json",e.POSTER="images/poster.png",e))(A||{});function z(e){let{urlPrefix:t,nodePath:o,shaderName:r,timestamp:n}=e;return`${t}/root/${o}.${r}.glsl?t=${n}`}function W(e){let{urlPrefix:t,nodePath:o,timestamp:r}=e;return`${t}/root/${o}.txt?t=${r}`}function I(e,t){let o=Object.keys(e.shaders);for(let r of o){let n=e.shaders[r],c=Object.keys(n);for(let u of c){let m=n[u];t({nodePath:r,shaderName:u,timestamp:m})}}}function b(e,t){let o=Object.keys(e.jsFunctionBodies);for(let r of o){let n=e.jsFunctionBodies[r];t({nodePath:r,timestamp:n})}}var x=class{static async importSceneData(t){t.editorMode==null&&(t.editorMode=!1);let o=t.manifest,r=t.urlPrefix||A.CODE_PREFIX,n=Object.keys(o.nodes),c=[];for(let s of n){let a=o.nodes[s],l=`${r}/root/${s}.json?t=${a}`;c.push(l)}let u=`${r}/root.json?t=${o.root}`,m=`${r}/properties.json?t=${o.properties}`,h=[u,m];if(t.editorMode){let s=Date.now();h.push(`${r}/ui.json?t=${s}`)}for(let s of c)h.push(s);let M=[];I(o,s=>{let a=z({urlPrefix:r,...s});h.push(a),M.push(a)});let P=[];b(o,s=>{let a=W({urlPrefix:r,...s});h.push(a),P.push(a)});let j=0,d=h.length-(M.length+P.length),_=h.length;function O(){j++;let s=j/_,a=w.sceneData,l=a.start+a.mult*s;t.onProgress&&t.onProgress(l),U.dispatchProgressEvent(l,t.sceneName)}let S=h.map(s=>L(s)).map(s=>fetch(s)),f=await Promise.all(S),R=f.slice(0,d),y=f.slice(d),D=await Promise.all([...R.map(s=>(O(),s.json())),...y.map(s=>(O(),s.text()))]),p=D.slice(0,d),E=D.slice(d),i=0,g={};I(o,s=>{let a=E[i],{nodePath:l,shaderName:Y}=s;g[l]=g[l]||{},g[l][Y]=a,i++});let T={};b(o,s=>{let a=E[i],{nodePath:l}=s;T[l]=a,i++});let F={root:p[0],properties:p[1],shaders:g,jsFunctionBodies:T},$=2;t.editorMode&&(F.ui=p[2],$+=1);let N={},v=Object.keys(o.nodes);for(let s=0;s<v.length;s++){let a=v[s],l=p[s+$];N[a]=l}return this.assemble(F,v,N)}static async assemble(t,o,r){let n={root:t.root,properties:t.properties,ui:t.ui,shaders:t.shaders,jsFunctionBodies:t.jsFunctionBodies};for(let c=0;c<o.length;c++){let u=o[c],m=r[u];this._insertChildData(n.root,u,m)}return n}static _insertChildData(t,o,r){let n=o.split("/");if(n.length==1)t.nodes||(t.nodes={}),t.nodes[o]=r;else{let c=n.shift(),u=n.join("/"),m=t.nodes[c];this._insertChildData(m,u,r)}}};var V={properties:"1685334973667",root:"1685271802372",nodes:{geo1:"1685271802372","geo1/MAT":"1685271802372","geo1/MAT/meshStandardBuilder_GROUND":"1685271802372","geo1/MAT/meshStandardBuilder_PLAYER":"1685271802372","geo1/MAT/meshStandardBuilder_BLOCKS":"1685271802372","geo1/physicsPlayer1":"1685271802372","geo1/cameraControls_PLAYER1":"1685271802372","geo1/physicsWorld1":"1685271802372",lights:"1685271802372",cameras:"1685271802372","cameras/cameraControls1":"1685271802372",env:"1685271802372","env/MAT":"1685271802372","env/MAT/meshLambertBuilder_INSTANCES":"1685271802372"},shaders:{"/geo1/MAT/meshStandardBuilder_GROUND":{vertex:"1685272363188",fragment:"1685272363188","customDepthMaterial.vertex":"1685272363188","customDepthMaterial.fragment":"1685272363188","customDistanceMaterial.vertex":"1685272363188","customDistanceMaterial.fragment":"1685272363188","customDepthDOFMaterial.vertex":"1685272363188","customDepthDOFMaterial.fragment":"1685272363188"},"/geo1/MAT/meshStandardBuilder_PLAYER":{vertex:"1685272363188",fragment:"1685272363188","customDepthMaterial.vertex":"1685272363188","customDepthMaterial.fragment":"1685272363188","customDistanceMaterial.vertex":"1685272363188","customDistanceMaterial.fragment":"1685272363188","customDepthDOFMaterial.vertex":"1685272363188","customDepthDOFMaterial.fragment":"1685272363188"},"/geo1/MAT/meshStandardBuilder_BLOCKS":{vertex:"1685272363188",fragment:"1685272363188","customDepthMaterial.vertex":"1685272363188","customDepthMaterial.fragment":"1685272363188","customDistanceMaterial.vertex":"1685272363188","customDistanceMaterial.fragment":"1685272363188","customDepthDOFMaterial.vertex":"1685272363188","customDepthDOFMaterial.fragment":"1685272363188"},"/env/MAT/meshLambertBuilder_INSTANCES":{vertex:"1685272363188",fragment:"1685272363188","customDepthMaterial.vertex":"1685272363188","customDepthMaterial.fragment":"1685272363188","customDistanceMaterial.vertex":"1685272363188","customDistanceMaterial.fragment":"1685272363188","customDepthDOFMaterial.vertex":"1685272363188","customDepthDOFMaterial.fragment":"1685272363188"}},jsFunctionBodies:{"/geo1/physicsPlayer1":"1685272363188","/geo1/physicsWorld1":"1685272363188"}},C=async(e={})=>{let t=e.sceneDataRoot||"./polygonjs/scenes";return await x.importSceneData({sceneName:"default",urlPrefix:t+"/default",manifest:V,onProgress:e.onProgress})};var k=async function(e={}){let{onProgress:t,domElement:o,configureSceneData:r,autoPlay:n,createViewer:c,sceneDataRoot:u,assetsRoot:m,libsRootPrefix:h,printWarnings:M,renderer:P,cameraMaskOverride:j}=e,d=e.sceneData,_=e.runRegister!=null?e.runRegister:!0,B=(e.loadModules!=null?e.loadModules:!0)?[]:[],S=[import("./loadSceneFromSceneData-3KMZE22M.js"),d==null?C({onProgress:t,sceneDataRoot:u}):(()=>new Promise(i=>i()))()],f=await Promise.all(S),{Poly:R,loadSceneFromSceneData_default:y}=f[0];d==null&&(d=f[1]),r&&r(d);let D=[];for(let i=2;i<f.length;i++)D.push(f[i]);let p=0;for(let i of B){let g=i+"Module";R.registerModule(D[p][g]),p++}return await y({onProgress:t,sceneData:d,domElement:o,runRegister:_,autoPlay:n,createViewer:c,assetsRoot:m,libsRootPrefix:h,printWarnings:M,renderer:P,cameraMaskOverride:j})};var G=async function(e={}){return e&&e.createViewer==null&&(e.createViewer=!0),k(e)};async function ce(e){let{publicPath:t,onProgress:o}=e,r=e.domElement||"polygonjs-app-default";return await G({domElement:r,autoPlay:!0,onProgress:o,sceneDataRoot:t+"/polygonjs/scenes",assetsRoot:t,libsRootPrefix:t})}export{ce as loadSceneAndMount_default};
